/*
 MIT
*/
(function(f){f.fn.sortableLists=function(g){function n(a){if(b.isDragged){var m=b.cEl,e=b.doc,h=b.win;"touchmove"===a.type&&v(a);a.pageX||A(a);e.scrollTop()>b.rootEl.offset.top-10&&50>a.clientY?b.upScroll?(a.pageY-=c.scroll,f("html, body").each(function(a){f(this).scrollTop(f(this).scrollTop()-c.scroll)}),p(a)):d(a):e.scrollTop()+h.height()<b.rootEl.offset.top+b.rootEl.el.outerHeight(!1)+10&&50>h.height()-a.clientY?b.downScroll?(a.pageY+=c.scroll,f("html, body").each(function(a){f(this).scrollTop(f(this).scrollTop()+
c.scroll)}),p(a)):k(a):w(b);b.oElOld=b.oEl;m.el[0].style.visibility="hidden";b.oEl=oEl=B(a.pageX,a.pageY);m.el[0].style.visibility="visible";C(a,b);D(a,b)}}function l(a){var m=b.cEl,e=f("#sortableListsHint",b.rootEl.el),d=h[0].style,u=null,g=!1,k=f("#sortableListsHintWrapper");"touchend"!==a.type&&"touchcancel"!==a.type||v(a);"block"==d.display&&e.length&&b.isAllowed?(u=e,g=!0):(u=b.placeholderNode,g=!1);offset=u.offset();m.el.animate({left:offset.left-b.cEl.mL,top:offset.top-b.cEl.mT},250,function(){E(m);
u.after(m.el[0]);u[0].style.display="none";d.display="none";e.remove();k.removeAttr("id").removeClass(c.hintWrapperClass);k.length&&k.prev("div").append(r.clone(!0));g?b.placeholderNode.slideUp(150,function(){b.placeholderNode.remove();x();c.onChange(m.el);c.complete(m.el);b.isDragged=!1}):(b.placeholderNode.remove(),x(),c.complete(m.el),b.isDragged=!1)});w(b);b.doc.unbind("mousemove touchmove",n).unbind("mouseup touchend touchcancel",l)}function d(a){b.upScroll||(b.upScroll=setInterval(function(){b.doc.trigger("mousemove")},
50))}function k(a){b.downScroll||(b.downScroll=setInterval(function(){b.doc.trigger("mousemove")},50))}function p(a){b.pY=a.pageY;b.pX=a.pageX;b.cY=a.clientY;b.cX=a.clientX}function A(a){a.pageY=b.pY;a.pageX=b.pX;a.clientY=b.cY;a.clientX=b.cX}function w(a){clearInterval(a.upScroll);clearInterval(a.downScroll);a.upScroll=a.downScroll=!1}function v(a){a.pageX=a.originalEvent.touches[0].pageX;a.pageY=a.originalEvent.touches[0].pageY;a.screenX=a.originalEvent.touches[0].screenX;a.screenY=a.originalEvent.touches[0].screenY}
function D(a,b){var c=b.cEl;c.el.css({top:a.pageY-c.xyOffsetDiff.Y-c.mT,left:a.pageX-c.xyOffsetDiff.X-c.mL})}function B(a,c){if(!document.elementFromPoint)return null;var e=b.isRelEFP;if(null===e){var h,d;0<(h=b.doc.scrollTop())&&(e=null==(d=document.elementFromPoint(0,h+f(window).height()-1))||"HTML"==d.tagName.toUpperCase());0<(h=b.doc.scrollLeft())&&(e=null==(d=document.elementFromPoint(h+f(window).width()-1,0))||"HTML"==d.tagName.toUpperCase())}e&&(a-=b.doc.scrollLeft(),c-=b.doc.scrollTop());
e=f(document.elementFromPoint(a,c));if(b.rootEl.el.find(e).length){if(e.is("#sortableListsPlaceholder")||e.is("#sortableListsHint"))return null;if(!e.is("li"))return e=e.closest("li"),e[0]?e:null;if(e.is("li"))return e}else return null}function C(a,m){var e=m.oEl;if(e&&m.oElOld){var d=e.outerHeight(!1),g=a.pageY-e.offset().top;if(5>g)a:{f("#sortableListsHintWrapper",b.rootEl.el).length&&h.unwrap();if(a.pageX-e.offset().left<c.insertZone){if(e.prev("#sortableListsPlaceholder").length){h.css("display",
"none");break a}e.before(h)}else{d=e.children();g=e.children("ul").first();if(g.children().first().is("#sortableListsPlaceholder")){h.css("display","none");break a}g.length?g.prepend(h):(d.first().after(h),h.wrap(y));b.oEl&&q(e)}h.css("display","block");b.isAllowed=c.isAllowed(b.cEl.el,h,h.parents("li").first())}else if(d-5<g)a:{f("#sortableListsHintWrapper",b.rootEl.el).length&&h.unwrap();if(a.pageX-e.offset().left<c.insertZone){if(e.next("#sortableListsPlaceholder").length){h.css("display","none");
break a}e.after(h)}else{d=e.children();g=e.children(c.listSelector).last();if(g.children().last().is("#sortableListsPlaceholder")){h.css("display","none");break a}g.length?d.last().append(h):(e.append(h),h.wrap(y));b.oEl&&q(e)}h.css("display","block");b.isAllowed=c.isAllowed(b.cEl.el,h,h.parents("li").first())}}}function q(a){a.removeClass("sortableListsClosed").addClass("sortableListsOpen");a.children(c.listSelector).css("display","block");a=a.children("div").children(".sortableListsOpener").first();
"html"==c.opener.as?a.html(c.opener.close):"class"==c.opener.as?a.addClass(c.opener.close).removeClass(c.opener.open):a.css("background-image","url("+c.opener.close+")")}function z(a){a.removeClass("sortableListsOpen").addClass("sortableListsClosed");a.children(c.listSelector).css("display","none");a=a.children("div").children(".sortableListsOpener").first();"html"==c.opener.as?a.html(c.opener.open):"class"==c.opener.as?a.addClass(c.opener.open).removeClass(c.opener.close):a.css("background-image",
"url("+c.opener.open+")")}function E(a){var b=a.el[0].style;a.el.removeClass(c.currElClass+" sortableListsCurrent");b.top="0";b.left="0";b.position="relative";b.width="auto"}function x(){f(c.listSelector,b.rootEl.el).each(function(a){f(this).children().length||(f(this).prev("div").children(".sortableListsOpener").first().remove(),f(this).remove())})}var t=f("body").css("position","relative"),F={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",
position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(t.css("margin-top")),left:0-parseInt(t.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!1,open:"",close:"",openerCss:{"float":"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,scroll:20,isAllowed:function(a,b,c){return!0},onDragStart:function(a,
b){return!0},onChange:function(a){return!0},complete:function(a){return!0}},c=f.extend(!0,{},F,g),G=f("<"+c.listSelector+" />").prependTo(t).attr("id","sortableListsBase").css(c.baseCss).addClass(c.baseClass),H=f("<li />").attr("id","sortableListsPlaceholder").css(c.placeholderCss).addClass(c.placeholderClass),h=f("<li />").attr("id","sortableListsHint").css(c.hintCss).addClass(c.hintClass),y=f("<"+c.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(c.listsClass+" "+c.hintWrapperClass).css(c.listsCss).css(c.hintWrapperCss),
r=f("<span />").addClass("sortableListsOpener "+c.opener.openerClass).css(c.opener.openerCss).on("mousedown",function(a){a=f(this).closest("li");a.hasClass("sortableListsClosed")?q(a):z(a);return!1});"class"==c.opener.as?r.addClass(c.opener.close):"html"==c.opener.as?r.html(c.opener.close):(r.css("background-image","url("+c.opener.close+")"),console.error("jQuerySortableLists opener as background image is deprecated. In version 2.0.0 it will be removed. Use html instead please."));var b={isDragged:!1,
isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:f(document),win:f(window)};if(c.opener.active){if(!c.opener.open)throw"Opener.open value is not defined. It should be valid url, html or css class.";if(!c.opener.close)throw"Opener.close value is not defined. It should be valid url, html or css class.";f(this).find("li").each(function(){var a=f(this);a.children(c.listSelector).length&&(r.clone(!0).prependTo(a.children("div").first()),
a.hasClass("sortableListsOpen")?q(a):z(a))})}return this.on("mousedown touchstart",function(a){var d=f(a.target);if(!(!1!==b.isDragged||c.ignoreClass&&d.hasClass(c.ignoreClass))){a.preventDefault();"touchstart"===a.type&&v(a);var d=d.is("li")?d:d.closest("li"),e=f(this);if(d[0]){c.onDragStart(a,d);b.isDragged=!0;var g=parseInt(d.css("margin-top")),k=parseInt(d.css("margin-bottom")),p=parseInt(d.css("margin-left")),r=parseInt(d.css("margin-right")),q=d.offset(),t=d.innerHeight();b.rootEl={el:e,offset:e.offset(),
rootElClass:e.attr("class")};b.cEl={el:d,mT:g,mL:p,mB:k,mR:r,offset:q};b.cEl.xyOffsetDiff={X:a.pageX-b.cEl.offset.left,Y:a.pageY-b.cEl.offset.top};b.cEl.el.addClass("sortableListsCurrent "+c.currElClass);d.before(H);a=b.placeholderNode=f("#sortableListsPlaceholder");d.css({width:d.width(),position:"absolute",top:q.top-g,left:q.left-p}).prependTo(G);a.css({display:"block",height:t});h.css("height",t);b.doc.on("mousemove touchmove",n).on("mouseup touchend touchcancel",l)}}})};f.fn.sortableListsToArray=
function(g,n){g=g||[];var l=0;this.children("li").each(function(){var d=f(this),k={},p=d.attr("id");if(!p)throw console.log(d),"Previous item in console.log has no id. It is necessary to create the array.";k.id=p;k.parentId=n;k.value=d.data("value");k.order=l;g.push(k);d.children("ul,ol").sortableListsToArray(g,p);l++});return g};f.fn.sortableListsToHierarchy=function(){var g=[],n=0;f(this).children("li").each(function(){var l=f(this),d={},k=l.attr("id");if(!k)throw console.log(l),"Previous item in console.log has no id. It is necessary to create the array.";
d.id=k;d.value=l.data("value");d.order=n;g.push(d);d.children=l.children("ul,ol").sortableListsToHierarchy();n++});return g};f.fn.sortableListsToString=function(g,n){g=g||[];n=n||"no-parent";f(this).children("li").each(function(){var l=f(this),d=l.attr("id"),d=d?d.match(/(.+)[-=_](.+)/):null;if(!d)throw console.log(l),"Previous item in console.log has no id or id is not in required format xx_yy, xx-yy or xx=yy. It is necessary to create valid string.";g.push(d[1]+"["+d[2]+"]="+n);f(this).children("ul,ol").sortableListsToString(g,
d[2])});return g.join("&")}})(jQuery);
