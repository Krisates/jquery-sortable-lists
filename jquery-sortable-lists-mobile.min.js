/*
 MIT
*/
(function(e){e.fn.sortableLists=function(h){function n(a){if(b.isDragged){var g=b.cEl,c=b.doc,v=b.win;"touchmove"===a.type&&u(a);a.pageX||B(a);c.scrollTop()>b.rootEl.offset.top-10&&50>a.clientY?b.upScroll?(a.pageY-=d.scroll,e("html, body").each(function(a){e(this).scrollTop(e(this).scrollTop()-d.scroll)}),p(a)):f(a):c.scrollTop()+v.height()<b.rootEl.offset.top+b.rootEl.el.outerHeight(!1)+10&&50>v.height()-a.clientY?b.downScroll?(a.pageY+=d.scroll,e("html, body").each(function(a){e(this).scrollTop(e(this).scrollTop()+
d.scroll)}),p(a)):l(a):w(b);b.oElOld=b.oEl;g.el[0].style.visibility="hidden";b.oEl=oEl=C(a.pageX,a.pageY);g.el[0].style.visibility="visible";D(a,b);E(a,b)}}function m(a){var g=b.cEl,c=e("#sortableListsHint",b.rootEl.el),f=k[0].style,t=null,h=!1,l=e("#sortableListsHintWrapper");"touchend"!==a.type&&"touchcancel"!==a.type||u(a);"block"==f.display&&c.length&&b.isAllowed?(t=c,h=!0):(t=b.placeholderNode,h=!1);offset=t.offset();g.el.animate({left:offset.left-b.cEl.mL,top:offset.top-b.cEl.mT},250,function(){F(g);
t.after(g.el[0]);t[0].style.display="none";f.display="none";c.remove();l.removeAttr("id").removeClass(d.hintWrapperClass);l.length&&l.prev("div").append(x.clone(!0));h?b.placeholderNode.slideUp(150,function(){b.placeholderNode.remove();y();d.onChange(g.el);d.complete(g.el);b.isDragged=!1}):(b.placeholderNode.remove(),y(),d.complete(g.el),b.isDragged=!1)});w(b);b.doc.unbind("mousemove touchmove",n).unbind("mouseup touchend touchcancel",m);d.complete(g.el)}function f(a){b.upScroll||(b.upScroll=setInterval(function(){b.doc.trigger("mousemove")},
50))}function l(a){b.downScroll||(b.downScroll=setInterval(function(){b.doc.trigger("mousemove")},50))}function p(a){b.pY=a.pageY;b.pX=a.pageX;b.cY=a.clientY;b.cX=a.clientX}function B(a){a.pageY=b.pY;a.pageX=b.pX;a.clientY=b.cY;a.clientX=b.cX}function w(a){clearInterval(a.upScroll);clearInterval(a.downScroll);a.upScroll=a.downScroll=!1}function u(a){a.pageX=a.originalEvent.touches[0].pageX;a.pageY=a.originalEvent.touches[0].pageY;a.screenX=a.originalEvent.touches[0].screenX;a.screenY=a.originalEvent.touches[0].screenY}
function E(a,b){var c=b.cEl;c.el.css({top:a.pageY-c.xyOffsetDiff.Y-c.mT,left:a.pageX-c.xyOffsetDiff.X-c.mL})}function C(a,g){if(!document.elementFromPoint)return null;var c=b.isRelEFP;if(null===c){var d,f;0<(d=b.doc.scrollTop())&&(c=null==(f=document.elementFromPoint(0,d+e(window).height()-1))||"HTML"==f.tagName.toUpperCase());0<(d=b.doc.scrollLeft())&&(c=null==(f=document.elementFromPoint(d+e(window).width()-1,0))||"HTML"==f.tagName.toUpperCase())}c&&(a-=b.doc.scrollLeft(),g-=b.doc.scrollTop());
c=e(document.elementFromPoint(a,g));if(b.rootEl.el.find(c).length){if(c.is("#sortableListsPlaceholder")||c.is("#sortableListsHint"))return null;if(!c.is("li"))return c=c.closest("li"),c[0]?c:null;if(c.is("li"))return c}else return null}function D(a,g){var c=g.oEl;if(c&&g.oElOld){var f=c.outerHeight(!1),h=a.pageY-c.offset().top;if(5>h)a:{e("#sortableListsHintWrapper",b.rootEl.el).length&&k.unwrap();if(a.pageX-c.offset().left<d.insertZone){if(c.prev("#sortableListsPlaceholder").length){k.css("display",
"none");break a}c.before(k)}else{f=c.children();h=c.children("ul").first();if(h.children().first().is("#sortableListsPlaceholder")){k.css("display","none");break a}h.length?h.prepend(k):(f.first().after(k),k.wrap(z));b.oEl&&q(c)}k.css("display","block");b.isAllowed=d.isAllowed(b.cEl.el,e("#sortableListsHint"),c)}else if(f-5<h)a:{e("#sortableListsHintWrapper",b.rootEl.el).length&&k.unwrap();if(a.pageX-c.offset().left<d.insertZone){if(c.next("#sortableListsPlaceholder").length){k.css("display","none");
break a}c.after(k)}else{f=c.children();h=c.children(d.listSelector).last();if(h.children().last().is("#sortableListsPlaceholder")){k.css("display","none");break a}h.length?f.last().append(k):(c.append(k),k.wrap(z));b.oEl&&q(c)}k.css("display","block");b.isAllowed=d.isAllowed(b.cEl.el,e("#sortableListsHint"),c)}}}function q(a){a.removeClass("sortableListsClosed").addClass("sortableListsOpen");a.children("ul, ol").css("display","block");a.children("div").children(".sortableListsOpener").first().css("background-image",
"url("+d.opener.close+")")}function A(a){a.removeClass("sortableListsOpen").addClass("sortableListsClosed");a.children("ul, ol").css("display","none");a.children("div").children(".sortableListsOpener").first().css("background-image","url("+d.opener.open+")")}function F(a){var b=a.el[0].style;a.el.removeClass(d.currElClass+" sortableListsCurrent");b.top="0";b.left="0";b.position="relative";b.width="auto"}function y(){e(d.listSelector,b.rootEl.el).each(function(a){e(this).children().length||(e(this).prev("div").children(".sortableListsOpener").first().remove(),
e(this).remove())})}var r=e("body").css("position","relative"),G={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(r.css("margin-top")),left:0-parseInt(r.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!1,open:"",close:"",openerCss:{"float":"left",display:"inline-block","background-position":"center center",
"background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,scroll:20,isAllowed:function(a,b){return!0},onDragStart:function(a,b){return!0},onChange:function(a){return!0},complete:function(a){return!0}},d=e.extend(!0,{},G,h),H=e("<"+d.listSelector+" />").prependTo(r).attr("id","sortableListsBase").css(d.baseCss).addClass(d.baseClass),I=e("<li />").attr("id","sortableListsPlaceholder").css(d.placeholderCss).addClass(d.placeholderClass),k=e("<li />").attr("id",
"sortableListsHint").css(d.hintCss).addClass(d.hintClass),z=e("<"+d.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(d.listsClass+" "+d.hintWrapperClass).css(d.listsCss).css(d.hintWrapperCss),x=e("<span />").addClass("sortableListsOpener "+d.opener.openerClass).css("background-image","url("+d.opener.close+")").css(d.opener.openerCss).on("mousedown touchstart",function(a){a=e(this).closest("li");a.hasClass("sortableListsClosed")?q(a):A(a);return!1}),b={isDragged:!1,isRelEFP:null,
oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:e(document),win:e(window)};if(d.opener.active){if(!d.opener.open)throw"Opener object has no url for open image";if(!d.opener.close)throw"Opener object has no url for close image";e(this).find("li").each(function(){var a=e(this);a.children("ul,ol").length&&(x.clone(!0).prependTo(a.children("div").first()),a.hasClass("sortableListsOpen")||(a.addClass("sortableListsClosed"),
A(a)))})}return this.on("mousedown touchstart",function(a){var g=e(a.target);if(!(!1!==b.isDragged||d.ignoreClass&&g.hasClass(d.ignoreClass))){a.preventDefault();"touchstart"===a.type&&u(a);var g=g.is("li")?g:g.closest("li"),c=e(this);if(g[0]){d.onDragStart(a,g);b.isDragged=!0;var f=parseInt(g.css("margin-top")),h=parseInt(g.css("margin-bottom")),l=parseInt(g.css("margin-left")),p=parseInt(g.css("margin-right")),q=g.offset(),r=g.innerHeight();b.rootEl={el:c,offset:c.offset(),rootElClass:c.attr("class")};
b.cEl={el:g,mT:f,mL:l,mB:h,mR:p,offset:q};b.cEl.xyOffsetDiff={X:a.pageX-b.cEl.offset.left,Y:a.pageY-b.cEl.offset.top};b.cEl.el.addClass("sortableListsCurrent "+d.currElClass);g.before(I);a=b.placeholderNode=e("#sortableListsPlaceholder");g.css({width:g.width(),position:"absolute",top:q.top-f,left:q.left-l}).prependTo(H);a.css({display:"block",height:r});k.css("height",r);b.doc.on("mousemove touchmove",n).on("mouseup touchend touchcancel",m)}}})};e.fn.sortableListsToArray=function(h,n){h=h||[];var m=
0;this.children("li").each(function(){var f=e(this),l={},p=f.attr("id");if(!p)throw console.log(f),"Previous item in console.log has no id. It is necessary to create the array.";l.id=p;l.parentId=n;l.value=f.data("value");l.order=m;h.push(l);f.children("ul,ol").sortableListsToArray(h,p);m++});return h};e.fn.sortableListsToHierarchy=function(){var h=[],n=0;e(this).children("li").each(function(){var m=e(this),f={},l=m.attr("id");if(!l)throw console.log(m),"Previous item in console.log has no id. It is necessary to create the array.";
f.id=l;f.value=m.data("value");f.order=n;h.push(f);f.children=m.children("ul,ol").sortableListsToHierarchy();n++});return h};e.fn.sortableListsToString=function(h,n){h=h||[];n=n||"no-parent";e(this).children("li").each(function(){var m=e(this),f=m.attr("id"),f=f?f.match(/(.+)[-=_](.+)/):null;if(!f)throw console.log(m),"Previous item in console.log has no id or id is not in required format xx_yy, xx-yy or xx=yy. It is necessary to create valid string.";h.push(f[1]+"["+f[2]+"]="+n);e(this).children("ul,ol").sortableListsToString(h,
f[2])});return h.join("&")}})(jQuery);
