/*
 GNU General public license
*/
(function(d){d.fn.sortableLists=function(e){function h(c){if(a.isDragged){var n=a.cEl,b=a.doc,r=a.win;c.pageX||q(c);b.scrollTop()>a.rootEl.offset.top-10&&50>c.clientY?a.upScroll?(c.pageY-=f.scroll,d("html, body").each(function(a){d(this).scrollTop(d(this).scrollTop()-f.scroll)}),p(c)):g(c):b.scrollTop()+r.height()<a.rootEl.offset.top+a.rootEl.el.outerHeight(!1)+10&&50>r.height()-c.clientY?a.downScroll?(c.pageY+=f.scroll,d("html, body").each(function(a){d(this).scrollTop(d(this).scrollTop()+f.scroll)}),
p(c)):k(c):u(a);a.oElOld=a.oEl;n.el[0].style.visibility="hidden";a.oEl=oEl=w(c.pageX,c.pageY);n.el[0].style.visibility="visible";x(c,a);y(c,a)}}function m(c){var n=a.cEl,b=n.el[0].style,r=d("#sListsHint",a.rootEl.el),e=l[0].style,g=null,k=!1;c=null;a.isDragged=!1;"block"==e.display&&r.length&&f.isAllowed(n,r,a.oEl)?(g=r,k=!0):(g=a.placeholderNode,k=!1);c=g.offset();n.el.animate({left:c.left-a.cEl.mL,top:c.top-a.cEl.mT},250,function(){b.top="0";b.left="0";b.position="relative";b.width="auto";g.after(n.el[0]);
g[0].style.display="none";e.display="none";r.remove();d("#sListsHintWrapper").removeAttr("id").removeClass(f.hintWrapperClass);d(f.listSelector,a.rootEl.el).each(function(a){d(this).children().length||d(this).remove()});k&&a.placeholderNode.slideUp(150,function(){a.placeholderNode.siblings().length?a.placeholderNode.remove():a.placeholderNode.parent().remove()})});u(a);a.doc.unbind("mousemove",h).unbind("mouseup",m)}function g(c){a.upScroll||(a.upScroll=setInterval(function(){a.doc.trigger("mousemove")},
50))}function k(c){a.downScroll||(a.downScroll=setInterval(function(){a.doc.trigger("mousemove")},50))}function p(c){a.pY=c.pageY;a.pX=c.pageX;a.cY=c.clientY;a.cX=c.clientX}function q(c){c.pageY=a.pY;c.pageX=a.pX;c.clientY=a.cY;c.clientX=a.cX}function u(a){clearInterval(a.upScroll);clearInterval(a.downScroll);a.upScroll=a.downScroll=!1}function y(a,d){var b=d.cEl;b.el.css({top:a.pageY-b.xyOffsetDiff.Y-b.mT,left:a.pageX-b.xyOffsetDiff.X-b.mL})}function w(c,n){if(!document.elementFromPoint)return null;
var b=a.isRelEFP;if(null===b){var e,f;0<(e=a.doc.scrollTop())&&(b=null==(f=document.elementFromPoint(0,e+d(window).height()-1))||"HTML"==f.tagName.toUpperCase());0<(e=a.doc.scrollLeft())&&(b=null==(f=document.elementFromPoint(e+d(window).width()-1,0))||"HTML"==f.tagName.toUpperCase())}b&&(c-=a.doc.scrollLeft(),n-=a.doc.scrollTop());b=d(document.elementFromPoint(c,n));if(a.rootEl.el.find(b).length){if(b.is("#sListsPlaceholder")||b.is("#sListsHint"))return null;if(!b.is("li"))return b=b.closest("li"),
b[0]?b:null;if(b.is("li"))return b}else return null}function x(c,e){var b=e.oEl;if(b&&e.oElOld){var g=b.outerHeight(!1),h=c.pageY-b.offset().top;if(5>h)a:{d("#sListsHintWrapper",a.rootEl.el).length&&l.unwrap();if(c.pageX-b.offset().left<f.insertZone){if(b.prev("#sListsPlaceholder").length){l.css("display","none");break a}b.before(l)}else{g=b.children();h=b.children("ul").first();if(h.children().first().is("#sListsPlaceholder")){l.css("display","none");break a}h.length?h.prepend(l):(g.first().after(l),
l.wrap(v));a.oEl&&b.removeClass("sortableListsClose").children("ul,ol").css("display","block")}l.css("display","block");f.isAllowed(a.cEl,d("#sListsHint"),b)}else if(g-5<h)a:{d("#sListsHintWrapper",a.rootEl.el).length&&l.unwrap();if(c.pageX-b.offset().left<f.insertZone){if(b.next("#sListsPlaceholder").length){l.css("display","none");break a}b.after(l)}else{g=b.children();h=b.children(f.listSelector).last();a.oEl&&b.removeClass("sortableListsClose");if(h.children().last().is("#sListsPlaceholder")){l.css("display",
"none");break a}h.length?g.last().append(l):(b.append(l),l.wrap(v));a.oEl&&b.removeClass("sortableListsClose").children("ul,ol").css("display","block")}l.css("display","block");f.isAllowed(a.cEl,d("#sListsHint"),b)}}}var t=d("body").css("position","relative"),z={currElClass:"",curElCss:{},placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",
top:0-parseInt(t.css("margin-top")),left:0-parseInt(t.css("margin-left")),margin:0,padding:0,"z-index":2500},listSelector:"ul",listsClass:"",insertZone:50,scroll:20,isAllowed:function(a,d){return!0}},f=d.extend(!0,{},z,e),A=d("<"+f.listSelector+" />").prependTo(t).attr("id","sListsBase").css(f.baseCss).addClass(f.baseClass),B=d("<li />").attr("id","sListsPlaceholder").css(f.placeholderCss).addClass(f.placeholderClass),l=d("<li />").attr("id","sListsHint").css(f.hintCss).addClass(f.hintClass),v=d("<"+
f.listSelector+" />").attr("class",f.listsClass).attr("id","sListsHintWrapper").css(f.hintWrapperCss).addClass(f.hintWrapperClass),a={isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:d(document),win:d(window)};d(".sortableListsOpener").on("mousedown",function(a){d(this).closest("li").children("ul, ol").slideToggle(100,function(){d(this).closest("li").toggleClass("sortableListsClose")});return!1});return this.on("mousedown",
function(c){c.preventDefault();var e=d(c.target).is("li")?d(c.target):d(c.target).closest("li"),b=d(this);if(e[0]){a.isDragged=!0;var f=parseInt(e.css("margin-top")),g=parseInt(e.css("margin-bottom")),k=parseInt(e.css("margin-left")),p=parseInt(e.css("margin-right")),q=e.offset(),t=e.outerHeight(!1);a.rootEl={el:b,offset:b.offset()};a.cEl={el:e,mT:f,mL:k,mB:g,mR:p,offset:q};a.cEl.xyOffsetDiff={X:c.pageX-a.cEl.offset.left,Y:c.pageY-a.cEl.offset.top};e.before(B);c=a.placeholderNode=d("#sListsPlaceholder");
e.css({width:e.width(),position:"absolute",top:q.top-f,left:q.left-k}).prependTo(A);c.css({display:"block",height:t});l.css("height",t);a.doc.on("mousemove",h).on("mouseup",m)}})};d.fn.sortableListsToArray=function(e,h,m){e=e?e:[];h=h?h:0;m=m?m:1;var g=1;this.children("li").each(function(){var k=d(this),p=[],q;if(!(q=k.attr("id")))throw console.log(k),"Previous item in console.log has no id. It is necessary to create the array.";p.id=q;p.parentId=h;p.value=k.data("value");p.branchOrder=g;e.push(p);
m++;k.children("ul").sortableListsToArray(e,q,m);g++});return e};d.fn.sortableListsToHierarchy=function(){var e=e?e:[],h=1;d(this).children("li").each(function(){var m,g=[],k=d(this);if(!(m=k.attr("id")))throw console.log(k),"Previous item in console.log has no id. It is necessary to create the array.";g.id=m;g.value=k.data("value");g.order=h;g.children=k.children("ul").sortableListsToHierarchy();e[h++]=g});return e};d.fn.sortableListsToString=function(e,h){e=e?e:[];h=h?h:0;d(this).children("li").each(function(){var m,
g=d(this);if(!(m=g.attr("id")))throw console.log(g),"Previous item in console.log has no id. It is necessary to create the array.";e.push(m+"="+h);d(this).children("ul, ol").sortableListsToString(e,m)});return e.join("&amp;")}})(jQuery);
