/*
 GNU General public license
*/
(function(d){d.fn.sortableLists=function(e){function h(c){if(a.isDragged){var q=a.cEl,b=a.doc,e=a.win;c.pageX||p(c);b.scrollTop()>a.rootEl.offset.top-10&&50>c.clientY?a.upScroll?(c.pageY-=g.scroll,d("html, body").each(function(a){d(this).scrollTop(d(this).scrollTop()-g.scroll)}),n(c)):f(c):b.scrollTop()+e.height()<a.rootEl.offset.top+a.rootEl.el.outerHeight(!1)+10&&50>e.height()-c.clientY?a.downScroll?(c.pageY+=g.scroll,d("html, body").each(function(a){d(this).scrollTop(d(this).scrollTop()+g.scroll)}),
n(c)):k(c):u(a);a.oElOld=a.oEl;q.el[0].style.visibility="hidden";a.oEl=oEl=w(c.pageX,c.pageY);q.el[0].style.visibility="visible";x(c,a);y(c,a)}}function m(c){var q=a.cEl,b=q.el[0].style,e=d("#sListsHint",a.rootEl.el),t=l[0].style,f=null,k=!1;c=null;a.isDragged=!1;"block"==t.display&&e.length&&a.isAllowed?(f=e,k=!0):(f=a.placeholderNode,k=!1);c=f.offset();q.el.animate({left:c.left-a.cEl.mL,top:c.top-a.cEl.mT},250,function(){b.top="0";b.left="0";b.position="relative";b.width="auto";f.after(q.el[0]);
f[0].style.display="none";t.display="none";e.remove();d("#sListsHintWrapper").removeAttr("id").removeClass(g.hintWrapperClass);d(g.listSelector,a.rootEl.el).each(function(a){d(this).children().length||d(this).remove()});k&&a.placeholderNode.slideUp(150,function(){a.placeholderNode.siblings().length?a.placeholderNode.remove():a.placeholderNode.parent().remove()})});u(a);a.doc.unbind("mousemove",h).unbind("mouseup",m);g.complete(q.el,f)}function f(c){a.upScroll||(a.upScroll=setInterval(function(){a.doc.trigger("mousemove")},
50))}function k(c){a.downScroll||(a.downScroll=setInterval(function(){a.doc.trigger("mousemove")},50))}function n(c){a.pY=c.pageY;a.pX=c.pageX;a.cY=c.clientY;a.cX=c.clientX}function p(c){c.pageY=a.pY;c.pageX=a.pX;c.clientY=a.cY;c.clientX=a.cX}function u(a){clearInterval(a.upScroll);clearInterval(a.downScroll);a.upScroll=a.downScroll=!1}function y(a,d){var b=d.cEl;b.el.css({top:a.pageY-b.xyOffsetDiff.Y-b.mT,left:a.pageX-b.xyOffsetDiff.X-b.mL})}function w(c,e){if(!document.elementFromPoint)return null;
var b=a.isRelEFP;if(null===b){var g,f;0<(g=a.doc.scrollTop())&&(b=null==(f=document.elementFromPoint(0,g+d(window).height()-1))||"HTML"==f.tagName.toUpperCase());0<(g=a.doc.scrollLeft())&&(b=null==(f=document.elementFromPoint(g+d(window).width()-1,0))||"HTML"==f.tagName.toUpperCase())}b&&(c-=a.doc.scrollLeft(),e-=a.doc.scrollTop());b=d(document.elementFromPoint(c,e));if(a.rootEl.el.find(b).length){if(b.is("#sListsPlaceholder")||b.is("#sListsHint"))return null;if(!b.is("li"))return b=b.closest("li"),
b[0]?b:null;if(b.is("li"))return b}else return null}function x(c,e){var b=e.oEl;if(b&&e.oElOld){var f=b.outerHeight(!1),h=c.pageY-b.offset().top;if(5>h)a:{d("#sListsHintWrapper",a.rootEl.el).length&&l.unwrap();if(c.pageX-b.offset().left<g.insertZone){if(b.prev("#sListsPlaceholder").length){l.css("display","none");break a}b.before(l)}else{f=b.children();h=b.children("ul").first();if(h.children().first().is("#sListsPlaceholder")){l.css("display","none");break a}h.length?h.prepend(l):(f.first().after(l),
l.wrap(v));a.oEl&&b.removeClass("sortableListsClose")}l.css("display","block");a.isAllowed=g.isAllowed(a.cEl.el,d("#sListsHint"),b)}else if(f-5<h)a:{d("#sListsHintWrapper",a.rootEl.el).length&&l.unwrap();if(c.pageX-b.offset().left<g.insertZone){if(b.next("#sListsPlaceholder").length){l.css("display","none");break a}b.after(l)}else{f=b.children();h=b.children(g.listSelector).last();if(h.children().last().is("#sListsPlaceholder")){l.css("display","none");break a}h.length?f.last().append(l):(b.append(l),
l.wrap(v));a.oEl&&b.removeClass("sortableListsClose")}l.css("display","block");a.isAllowed=g.isAllowed(a.cEl.el,d("#sListsHint"),b)}}}var r=d("body").css("position","relative"),z={currElClass:"",curElCss:{},placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(r.css("margin-top")),left:0-parseInt(r.css("margin-left")),margin:0,
padding:0,"z-index":2500},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,scroll:20,isAllowed:function(a,d){return!0}},g=d.extend(!0,{},z,e),A=d("<"+g.listSelector+" />").prependTo(r).attr("id","sListsBase").css(g.baseCss).addClass(g.baseClass),B=d("<li />").attr("id","sListsPlaceholder").css(g.placeholderCss).addClass(g.placeholderClass),l=d("<li />").attr("id","sListsHint").css(g.hintCss).addClass(g.hintClass),v=d("<"+g.listSelector+" />").attr("class",g.listsClass).attr("id","sListsHintWrapper").css(g.hintWrapperCss).css(g.listsCss).addClass(g.hintWrapperClass),
C=d("<span />").addClass("sortableListsOpener"),a={isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:d(document),win:d(window)};d(this).find("li").each(function(){var a=d(this);a.children("ul,ol").length&&(a.addClass("sortableListsClose"),C.clone().prependTo(a.children("div").first()))});d(".sortableListsOpener").on("mousedown",function(a){d(this).closest("li").toggleClass("sortableListsClose");return!1});
return this.on("mousedown",function(c){c.preventDefault();var e=d(c.target).is("li")?d(c.target):d(c.target).closest("li"),b=d(this);if(e[0]){a.isDragged=!0;var f=parseInt(e.css("margin-top")),g=parseInt(e.css("margin-bottom")),k=parseInt(e.css("margin-left")),n=parseInt(e.css("margin-right")),p=e.offset(),r=e.outerHeight(!1);a.rootEl={el:b,offset:b.offset()};a.cEl={el:e,mT:f,mL:k,mB:g,mR:n,offset:p};a.cEl.xyOffsetDiff={X:c.pageX-a.cEl.offset.left,Y:c.pageY-a.cEl.offset.top};e.before(B);c=a.placeholderNode=
d("#sListsPlaceholder");e.css({width:e.width(),position:"absolute",top:p.top-f,left:p.left-k}).prependTo(A);c.css({display:"block",height:r});l.css("height",r);a.doc.on("mousemove",h).on("mouseup",m)}})};d.fn.sortableListsToArray=function(e,h,m){e=e?e:[];h=h?h:0;m=m?m:1;var f=1;this.children("li").each(function(){var k=d(this),n=[],p;if(!(p=k.attr("id")))throw console.log(k),"Previous item in console.log has no id. It is necessary to create the array.";n.id=p;n.parentId=h;n.value=k.data("value");
n.branchOrder=f;e.push(n);m++;k.children("ul").sortableListsToArray(e,p,m);f++});return e};d.fn.sortableListsToHierarchy=function(){var e=e?e:[],h=1;d(this).children("li").each(function(){var m,f=[],k=d(this);if(!(m=k.attr("id")))throw console.log(k),"Previous item in console.log has no id. It is necessary to create the array.";f.id=m;f.value=k.data("value");f.order=h;f.children=k.children("ul").sortableListsToHierarchy();e[h++]=f});return e};d.fn.sortableListsToString=function(e,h){e=e?e:[];h=h?
h:0;d(this).children("li").each(function(){var m,f=d(this);if(!(m=f.attr("id")))throw console.log(f),"Previous item in console.log has no id. It is necessary to create the array.";e.push(m+"="+h);d(this).children("ul, ol").sortableListsToString(e,m)});return e.join("&amp;")}})(jQuery);
